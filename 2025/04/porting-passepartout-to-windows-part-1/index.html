


<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">
    
<head>
    <title>Passepartout is your go-to app for VPN and privacy.</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="author" content="Davide De Rosa" />
    <meta name="description" content="Passepartout is your go-to app for VPN and privacy. Tailored for Apple platforms, Passepartout is open-source and fully available on GitHub." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-title" content="Passepartout">

    <!-- OpenGraph -->

    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Passepartout" />
    <meta property="og:title" content="Porting Passepartout on Windows: Part 1" />
    <meta property="og:description" content="Porting Passepartout on Windows: Part 1" />
    <meta property="og:image" content="https://passepartoutvpn.app/s/logo.png?1744625830" />
    <meta property="og:url" content="https://passepartoutvpn.app/2025/04/porting-passepartout-to-windows-part-1/" />

    <!-- Twitter -->

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@keeshux" />
    <meta name="twitter:title" content="Porting Passepartout on Windows: Part 1" />
    <meta name="twitter:description" content="Porting Passepartout on Windows: Part 1" />
    <meta name="twitter:image" content="https://passepartoutvpn.app/s/logo.png?1744625830" />
    <meta name="twitter:url" content="https://passepartoutvpn.app/2025/04/porting-passepartout-to-windows-part-1/" />

    <link rel="canonical" href="https://passepartoutvpn.app/2025/04/porting-passepartout-to-windows-part-1/" />
    <link rel="author" href="https://davidederosa.com" />

    <link rel="stylesheet" href="/s/main.css?1744625830" />
    <link rel="stylesheet" href="/s/main-mobile.css?1744625830" media="only screen and (max-width: 600px)" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha384-t1nt8BQoYMLFN5p42tRAtuAAFQaCQODekUVeKKZrEnEyp4H2R0RHFz0KWpmj7i8g" crossorigin="anonymous">

    <link rel="shortcut icon" href="/s/favicon.ico?1744625830" />
    <link rel="apple-touch-icon" href="/s/iphone-icon-precomposed.png?1744625830" />

    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-011WMEB3FJ"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-011WMEB3FJ');
</script>


</head>

    <body>
        <div id="container">
            <header>
    <a href="https://passepartoutvpn.app"><img id="logo" src="/s/logo.svg" alt="Passepartout" /></a>
    <h1><a href="https://passepartoutvpn.app">Passepartout</a></h1>
    <p>Your go-to app for VPN and privacy.</p>
</header>

            <article class="post post-full" itemscope itemtype="https://schema.org/Article">
    <header>
        <div>
            <h2 itemprop="name">Porting Passepartout on Windows: Part 1</h2>
            <p class="post-date" itemprop="datepublished">Apr 14, 2025</p>
            <p class="post-tags">
                Tags:
                
                <a href="/blog/development">development</a>
                
                <a href="/blog/swift">swift</a>
                
                <a href="/blog/windows">windows</a>
                
            </p>
        </div>
        <div class="post-body">
            
            <em>Originally posted on <a href="https://davidederosa.com/2025/04/porting-passepartout-to-windows-part-1/">davidederosa.com</a> and <a href="https://linkedin.com/in/davidederosa">LinkedIn</a></em>
            
            <p>As <a href="">Partout</a>, my Swift framework for VPN and network configuration on Apple devices, has slowly gained shape, I set foot in an ambitious and novel, pioneering goal: <strong>making Partout a truly multiplatform Swift library</strong>.</p>

<p>It’s challenging, but it’s fun, and it’s the way to port <a href="https://passepartoutvpn.app">Passepartout</a> beyond the Apple platforms. So, here, I will progressively share my discoveries and encourage other people to give Swift a chance as a portable language. The language itself is fantastic. Using it outside Xcode? Not as much, but I’ve observed the trends over the years, and overall, things are getting better.</p>

<p>This <a href="https://developer.apple.com/videos/play/wwdc2024/10197/">video from WWDC 2024</a> where the speaker uses Neovim + CMake made me reflect on the increasing efforts that Apple is making to push Swift into the outer world. Endorsing Neovim to develop Swift is an incredible marketing move to expand on Linux primarily, but I don’t mind it because both Neovim and Swift are amazing products. However, little talk on the street about Windows, so here are my two cents.</p>

<p>Bear with me, this is a <em>very experimental</em> work in progress, that’s why I’d rather start with architectural concepts, and delve into technical details only after confirming that my approaches do well in practice.</p>

<h2 id="1-start-with-a-lean-core">1. Start with a lean core</h2>

<p>When I made Partout from the ashes of <a href="">TunnelKit</a>, I put special care into making the library core as lean as possible. No dependencies, no OS implementations, pure Swift. This mantra paid off very well in the long run because you realize how basic the Swift runtime is when you leave the comfortable macOS environment: a stripped version of the Foundation and Dispatch frameworks, not even Combine, and little more. I promise, this will hit you hard the first time.</p>

<p>I was equally shocked, yet positively, when <code class="language-plaintext highlighter-rouge">async</code> methods worked out of the box. This is not about Swift, though, rather about Windows. The level of discomfort I feel when I use Windows puts me in a constant disbelief when things, eventually, work as intended. As in “this is Windows, nothing can work without Visual Studio”. Fun fact: Swift requires the Visual Studio Build Tools.</p>

<p><strong>Challenge #1: Only depend on Foundation.</strong></p>

<h2 id="2-objc-no-thanks">2. ObjC? No, thanks</h2>

<p>Another painful wake-up call: the Swift toolchain does not support ObjC targets in SwiftPM on Windows. There are three scenarios:</p>

<ol>
  <li>If you depend on 3rd party Swift packages based on ObjC code, move on to something else. Most of the time there will be better options.</li>
  <li>If you need to write low-level code with Swift, prefer some well-crafted C routines. You’ll thank yourself later.</li>
  <li>If you (like me) have legacy ObjC code –a good amount of my OpenVPN implementation is written in ObjC for performance reasons, hear me out: it’s going to cause you trouble.</li>
</ol>

<p>As far as I can tell, there are no easy shortcuts to resolve point 3. Keep in mind that the first challenge still applies: pray that your ObjC codebase only depends on Foundation or libraries that <em>you</em> bundle –thus excluding Apple frameworks, or you’re basically screwed.</p>

<p>Assuming that this is the case, you should treat ObjC like any other “foreign” language, which is with an external build tool. Once you build the ObjC code as a static library (e.g. with a <code class="language-plaintext highlighter-rouge">Makefile</code>), you have the option to add it as a binary target to the SwiftPM manifest. The same way you would do with Rust or Go, to name some. Unfortunately, this degrades the otherwise neat automation of SwiftPM.</p>

<p>Currently, I’m exploring a solution to reuse my ObjC code as is with <a href="https://www.mingw-w64.org/">MinGW64</a> and <a href="https://www.gnustep.org/">GNUstep</a>, as you can see in the screenshot below (forgive my swearing after hours of frustrating attempts…). So far, so good, though I’m still concerned with how MSYS2/MinGW64 handles the binary architectures.</p>

<p><strong>Challenge #2: Prefer C over ObjC, if you can.</strong></p>

<h2 id="3-implementations">3. Implementations</h2>

<p>I still want to use the keychain and Network Extension on Apple systems. A lean core will inevitably lead to taking Swift targets depending on them out of the core and be imported conditionally. These are the “leaves” of the library, the ones where we have the most freedom, even on the programming language.</p>

<p>When it comes to Partout, this is of the utmost importance because it involves how the VPN functionality is implemented on each operating system. While this is clear to me on Apple (Network Extension), for Windows, I’m looking into the <a href="https://github.com/microsoft/UwpVpnPluginSample">Universal Windows Platform (UWP)</a>. As proof of the freedom we have in this area, the VPN code for Partout on Windows will likely be C#.</p>

<p><strong>Challenge #3: Isolate implementation targets.</strong></p>

<h2 id="4-c-is-the-common-denominator">4. C is the common denominator</h2>

<p>Sad to say, but it doesn’t really matter how cool your Swift library is (replace with any other language). The well-thought classes, the scalable design, the smart patterns, the tricky use of OOP: forget about any of those by the time you expose the library to a different programming language. Nobody cares, really, because interoperability is done in C.</p>

<p>Have you wondered how to expose a Swift protocol with an associatedtype to a Python library, an object with a lifetime, or even just a String? Well, the answer is straightforward: you don’t do that. Instead, you expose C wrappers from Swift with <a href="https://forums.swift.org/t/formalizing-cdecl/40677">@_cdecl</a>, which despite the leading underscore seems to be widely accepted as a pseudostable feature. It goes without saying, you will be limited to the standard C types.</p>

<p>This will be a late stage of the refactoring, today I’m not worried. A solid approach to challenge #1 would definitely make this easier.</p>

<p><strong>Challenge #4: Make your public interface a C API.</strong></p>

<h2 id="bottom-line">Bottom line</h2>

<p>I’m still in the early stages of bringing Swift to Windows with Partout, but the path is starting to reveal itself. Keep your core lean and pure Swift, avoid Objective-C where you can, isolate OS-specific implementations, and remember that C is the common ground across platforms. It’s experimental, sometimes frustrating, but genuinely fun—and worth sharing as it unfolds. Expect more on this throughout 2025.</p>

        </div>
        <div>
            <p>
                <a href="/feed.xml">Follow the blog</a>
                |
                <a href="/blog">Back to index</a>
            </p>
        </div>
    </header>
</article>





<h3>Related posts</h3>
<ul id="blog-posts" class="related">
    
    <li>
        <span class="post-preview"><a href="/2025/03/who-cares-about-performance/">Who cares about performance?</a></span>
        <span class="post-date">Mar 25, 2025</span>
    </li>
    
    <li>
        <span class="post-preview"><a href="/2025/03/rewriting-passepartout-for-v3/">Rewriting Passepartout for v3</a></span>
        <span class="post-date">Mar 11, 2025</span>
    </li>
    
    <li>
        <span class="post-preview"><a href="/2025/03/deploying-to-the-app-store-the-cost-you-didn-t-expect/">Deploying to the App Store: The cost you didn't expect</a></span>
        <span class="post-date">Mar 03, 2025</span>
    </li>
    
    <li>
        <span class="post-preview"><a href="/2025/03/the-path-to-an-obscure-crash/">The path to an obscure crash</a></span>
        <span class="post-date">Mar 02, 2025</span>
    </li>
    
</ul>


            <footer>
    <ul class="contacts">
        <li><a href="https://github.com/passepartoutvpn" title="The project on GitHub" class="fab fa-github"></a></li>
        <li><a href="https://buymeacoffee.com/passepartout" title="Support with a donation" class="fas fa-coins"></a></li>
        <li><a href="https://linkedin.com/in/davidederosa" title="Follow the author on LinkedIn" class="fab fa-linkedin"></a></li>
        <li><a href="https://x.com/keeshux" title="Follow the author on X" class="fab fa-x-twitter"></a></li>
        <li><a href="mailto:info@passepartoutvpn.app" title="Submit an inquiry" class="fa fa-envelope"></a></li>
        <li><a href="https://passepartoutvpn.app/feed.xml" title="Subscribe to the blog" class="fa-solid fa-rss"></a></li>
    </ul>
    <ul class="secondary">
        <li><a href="/faq/" title="Frequently Asked Questions">FAQ</a></li>
        <li>|</li>
        <li><a href="/blog/" title="Articles about Passepartout">Blog</a></li>
        <li>|</li>
        <li><a href="/providers/" title="Providers">Providers</a></li>
        <li>|</li>
        <li><a href="/about/" title="The team and story behind Passepartout">About</a></li>
    </ul>
    <p class="notice">
        The logo is taken from the awesome <a href="https://www.iconfinder.com/iconsets/circle-icons-1" title="Circle Icons">Circle Icons</a> set by <a href="https://www.elegantthemes.com/" title="Elegant Themes">Nick Roach</a>.<br />
        Make sure to read the <a href="/privacy/" title="Privacy policy">privacy policy</a>.<br />
        <br />
        Copyright (c) 2025 <a href="https://davidederosa.com" title="The author website">Davide De Rosa</a>
    </p>
</footer>

        </div>
    </body>
</html>
